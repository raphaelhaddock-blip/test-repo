name: Notifications & Alerts

# Send notifications for important events
on:
  issues:
    types: [opened, labeled]
  pull_request:
    types: [opened, ready_for_review, review_requested]
  release:
    types: [published]
  workflow_run:
    workflows: ["Run Tests"]
    types: [completed]

jobs:
  notify-new-issue:
    if: github.event_name == 'issues' && github.event.action == 'opened'
    runs-on: ubuntu-latest
    
    steps:
    - name: Check if critical
      id: check
      run: |
        if [[ "${{ contains(github.event.issue.labels.*.name, 'critical') }}" == "true" ]]; then
          echo "is_critical=true" >> $GITHUB_OUTPUT
        fi
    
    - name: Send notification
      if: steps.check.outputs.is_critical == 'true'
      run: |
        echo "üö® CRITICAL ISSUE OPENED"
        echo "Title: ${{ github.event.issue.title }}"
        echo "URL: ${{ github.event.issue.html_url }}"
        # Add Slack/email notification here

  notify-pr-ready:
    if: github.event_name == 'pull_request' && github.event.action == 'ready_for_review'
    runs-on: ubuntu-latest
    
    steps:
    - name: Notify reviewers
      run: |
        echo "üìù Pull Request Ready for Review"
        echo "Title: ${{ github.event.pull_request.title }}"
        echo "Author: ${{ github.event.pull_request.user.login }}"
        echo "URL: ${{ github.event.pull_request.html_url }}"

  notify-test-failure:
    if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'failure'
    runs-on: ubuntu-latest
    
    steps:
    - name: Send failure alert
      run: |
        echo "‚ùå TEST FAILURE DETECTED"
        echo "Workflow: ${{ github.event.workflow_run.name }}"
        echo "Branch: ${{ github.event.workflow_run.head_branch }}"
        echo "URL: ${{ github.event.workflow_run.html_url }}"

  notify-release:
    if: github.event_name == 'release' && github.event.action == 'published'
    runs-on: ubuntu-latest
    
    steps:
    - name: Announce release
      run: |
        echo "üöÄ NEW RELEASE PUBLISHED"
        echo "Version: ${{ github.event.release.tag_name }}"
        echo "Name: ${{ github.event.release.name }}"
        echo "URL: ${{ github.event.release.html_url }}"
        # Send to Slack, email, or create announcement